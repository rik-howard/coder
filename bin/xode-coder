#!/bin/bash

origin=$(pwd)
home=$(dirname $(dirname $0))
base=$home/var

rm -r $home/tmp 2> /dev/null
mkdir $home/tmp
javac -sourcepath $home/src -d $home/tmp $home/src/xaos/Xesser.java

template=$base/schema/template
mapping=$base/schema/mapping
target=~/desk/lrbh-coder
maps=$mapping/symbols" "$mapping/relations" "$mapping/records

rm -r $target 2> /dev/null
mkdir $target
java -cp $home/tmp xaos.Xesser -xode -from $template/src -with $maps -to $target
# java -cp $home/tmp xaos.Xesser -xode -from $template/tst -with $maps -to $target

for file in $(find $target -name "*.java")
do
  #echo $file
  cat $file | sed "s/_/ /g" > $file.tmp; cat $file.tmp > $file
  cat $file | sed "s/@0/[]/g" > $file.tmp; cat $file.tmp > $file
  cat $file | sed "s/@1/:/g" > $file.tmp; cat $file.tmp > $file
  cat $file | sed "s/@2/^[a-z][a-zA-Z0-9\\\\\\\.]*$/g" > $file.tmp; cat $file.tmp > $file
  cat $file | sed "s/@3/^[a-z][a-zA-Z0-9]*:[a-z][a-zA-Z0-9\\\\\\\.]*$/g" > $file.tmp; cat $file.tmp > $file
  cat $file | sed "s/@4/^:[a-z][a-zA-Z0-9\\\\\\\.]*[=[a-zA-Z0-9\\\\\\\.]]?$/g" > $file.tmp; cat $file.tmp > $file
  cat $file | sed "s/@5/^:$/g" > $file.tmp; cat $file.tmp > $file
  #cat $file
  rm $file.tmp
done
